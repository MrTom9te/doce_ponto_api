meta {
  name: 07 - Deletar Produto
  type: http
  seq: 7
}

delete {
  url: {{baseUrl}}/products/{{productId}}
  auth: bearer
}

auth:bearer {
  token: {{authToken}}
}

script:post-response {
  // Limpa a variável productId para evitar seu uso indevido após a exclusão
  if (res.getStatus() === 200) {
    bru.setVar("productId", null);
  }
}

tests {
  test("Deleção de produto deve ser bem-sucedida", function() {
    const body = res.getBody();

    // 1. Verifica o código de status
    expect(res.status).to.equal(200);

    // 2. Verifica a estrutura da resposta
    expect(body.success).to.be.true;
    expect(body.message).to.equal("Produto deletado com sucesso");
  });

  test("Deleção de produto com ID inexistente deve retornar 404", function() {
    // Para testar isso, você precisaria de uma requisição separada com um ID que já foi deletado ou nunca existiu
    // expect(res.status).to.equal(404);
    // expect(res.getBody().code).to.equal("PRODUCT_NOT_FOUND");
  });
}

docs {
  **Remove permanentemente um produto do catálogo.**

  Esta é a etapa final no ciclo de vida do produto para os testes. Utiliza o `authToken` para autenticação e o `productId` para identificar o produto a ser deletado.

  O teste valida se a API retorna uma resposta de sucesso confirmando a exclusão.

  **Ações Pós-Execução:**
  - Após a exclusão bem-sucedida, a variável de ambiente `productId` é limpa para garantir que não seja usada acidentalmente em testes futuros.
}
