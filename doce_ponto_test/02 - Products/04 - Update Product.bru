meta {
  name: 04 - Atualizar Produto
  type: http
  seq: 4
}

put {
  url: {{baseUrl}}/products/{{productId}}
  body: json
  auth: bearer
}

auth:bearer {
  token: {{authToken}}
}

body:json {
  {
    "name": "Bolo de Teste (Atualizado Bruno)",
    "description": "Uma nova descrição para o bolo de teste automatizado.",
    "price": 40.00,
    "isActive": false
  }
}

script:post-response {
  // Nada para salvar aqui, apenas testar a resposta
}

tests {
  test("Atualização de produto deve ser bem-sucedida", function() {
    const body = res.getBody();

    // 1. Verifica o código de status
    expect(res.status).to.equal(200);

    // 2. Verifica a estrutura da resposta
    expect(body.success).to.be.true;
    expect(body.message).to.equal("Produto atualizado com sucesso");
    expect(body.data).to.not.be.null;

    // 3. Verifica se os dados do produto foram realmente atualizados
    const product = body.data;
    expect(product.id).to.equal(bru.getVar("productId"));
    expect(product.name).to.equal("Bolo de Teste (Atualizado Bruno)");
    expect(product.description).to.equal("Uma nova descrição para o bolo de teste automatizado.");
    expect(product.price).to.equal(40.00);
    expect(product.isActive).to.be.false; // Espera-se que esteja desativado
    expect(product.updatedAt).to.be.a('string');
    expect(product.updatedAt).to.not.equal(product.createdAt); // Deve ter sido atualizado
  });

  test("Atualização de produto com ID inexistente deve retornar 404", function() {
    // Para testar isso, você precisaria de uma requisição separada com um ID inválido
    // expect(res.status).to.equal(404);
    // expect(res.getBody().code).to.equal("PRODUCT_NOT_FOUND");
  });

  test("Atualização de produto com dados inválidos (ex: preço negativo) deve falhar", function() {
    // Para testar isso, você precisaria de uma requisição separada com dados inválidos
    // expect(res.status).to.equal(400);\
    // expect(res.getBody().code).to.equal("INVALID_INPUT");
  });
}

docs {
  **Atualiza as informações de um produto existente.**

  Esta requisição utiliza o `authToken` para autenticação e o `productId` para identificar o produto a ser atualizado. Envia um corpo com os campos a serem atualizados, incluindo uma alteração no nome, preço e status `isActive`.

  Os testes validam se a resposta da API confirma a atualização e se os dados retornados refletem as alterações enviadas.
}
