meta {
  name: 06 - Ativar Produto
  type: http
  seq: 6
}

patch {
  url: {{baseUrl}}/products/{{productId}}/toggle
  body: json
  auth: bearer
}

auth:bearer {
  token: {{authToken}}
}

body:json {
  {
    "isActive": true
  }
}

script:post-response {
  // Nada para salvar aqui, apenas testar a resposta
}

tests {
  test("Reativação de produto deve ser bem-sucedida", function() {
    const body = res.getBody();

    // 1. Verifica o código de status
    expect(res.status).to.equal(200);

    // 2. Verifica a estrutura da resposta
    expect(body.success).to.be.true;
    expect(body.message).to.equal("Status do produto atualizado");
    expect(body.data).to.not.be.null;

    // 3. Verifica se o status do produto foi alterado para ativo
    const product = body.data;
    expect(product.id).to.equal(bru.getVar("productId"));
    expect(product.isActive).to.be.true;
    expect(product.updatedAt).to.be.a('string');
    expect(product.updatedAt).to.not.equal(product.createdAt); // Deve ter sido atualizado
  });

  test("Reativação de produto com ID inexistente deve retornar 404", function() {
    // Para testar isso, você precisaria de uma requisição separada com um ID inválido
    // expect(res.status).to.equal(404);
    // expect(res.getBody().code).to.equal("PRODUCT_NOT_FOUND");
  });
}

docs {
  **Altera o status de um produto de volta para ativo.**

  Esta requisição utiliza o `authToken` para autenticação e o `productId` para identificar o produto cujo status será alterado.
  É enviada uma requisição PATCH para o endpoint `/products/:id/toggle` com `isActive: true` no corpo.

  O teste valida se a API retorna uma resposta de sucesso e se o status `isActive` do produto retornado no corpo da resposta é `true`.
}
