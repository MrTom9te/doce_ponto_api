meta {
  name: 03 - Obter Detalhes do Pedido
  type: http
  seq: 3
}

get {
  url: {{baseUrl}}/orders/{{orderId}}
  body: none
  auth: bearer
}

headers {
  Content-Type: application/json
}

auth:bearer {
  token: {{authToken}}
}

script:pre-request {
  console.log("DEBUG: orderId for Get Order Details: ", bru.getVar("orderId"));
}

script:post-response {
  // Nada para salvar aqui, apenas testar a resposta
}

tests {
  test("Obtenção de detalhes do pedido deve ser bem-sucedida", function() {
    const body = res.getBody();
  
    // 1. Verifica o código de status
    expect(res.status).to.equal(200);
  
    // 2. Verifica a estrutura da resposta
    expect(body.success).to.be.true;
    expect(body.data).to.not.be.null;
  
    // 3. Verifica se o pedido retornado é o correto
    const order = body.data;
    expect(order.id).to.equal(bru.getVar("orderId"));
    expect(order.orderNumber).to.be.a('string');
    expect(order.customerName).to.equal("Cliente de Teste Automatizado");
    expect(order.customerPhone).to.equal("11912345678");
    expect(order.productId).to.equal(bru.getVar("publicProductId"));
    expect(order.productName).to.be.a('string');
    expect(order.quantity).to.equal(2);
    expect(order.unitPrice).to.be.a('number');
    expect(order.totalPrice).to.be.a('number');
    expect(order.deliveryDate.slice(0, 10)).to.equal("2099-12-31"); // Ajustado para slice
    expect(order.deliveryTime).to.equal("15h");
    expect(order.observations).to.equal("Pedido gerado por um teste automatizado.");
    expect(order.status).to.equal("pending"); // Status inicial, ou 'confirmed' se o teste anterior rodou
    expect(order.createdAt).to.be.a('string');
    expect(order.updatedAt).to.be.a('string');
  });
  
  test("Obtenção de detalhes do pedido com ID inexistente deve retornar 404", function() {
    // Para testar isso, você precisaria de uma requisição separada com um ID inválido
    // expect(res.status).to.equal(404);
    // expect(res.getBody().code).to.equal("ORDER_NOT_FOUND");
  });
}

docs {
  **Testa o endpoint autenticado para obter os detalhes de um pedido específico.**
  
  Esta requisição utiliza o `authToken` para autenticação e o `orderId` (salvo pelo teste `01 - Criar Pedido (Público)`) como parâmetro na URL para identificar o recurso.
  
  Os testes validam se a API retorna os dados corretos para o pedido solicitado e se a estrutura da resposta está de acordo com a especificação, com o `deliveryDate` ajustado para o formato "YYYY-MM-DD" para comparação.
}
